# é¢„å¤„ç†å·¥ä½œæµå®Œæ•´æŒ‡å—

## ğŸ“– å·¥ä½œæµæ¦‚è¿°

`preprocessing_workflow.wdl` æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŸºå› ç»„æµ‹åºæ•°æ®é¢„å¤„ç†å·¥ä½œæµï¼Œä½¿ç”¨ WDL (Workflow Description Language) ç¼–å†™ï¼Œä¸“é—¨ç”¨äº AWS Omics å¹³å°ã€‚è¯¥å·¥ä½œæµå®ç°äº†ä»åŸå§‹æµ‹åºæ•°æ®åˆ°é«˜è´¨é‡é¢„å¤„ç†æ•°æ®çš„å®Œæ•´æµç¨‹ã€‚

### ğŸ¯ ä¸»è¦åŠŸèƒ½
- åŸå§‹æµ‹åºæ•°æ®è´¨é‡è¯„ä¼°
- æ¥å¤´å»é™¤å’Œè´¨é‡è¿‡æ»¤
- æ•°æ®æ ¼å¼è½¬æ¢å’Œæ ‡å‡†åŒ–
- é‡å¤åºåˆ—å»é™¤
- ç»¼åˆè´¨é‡æŠ¥å‘Šç”Ÿæˆ

---

## ğŸ—ï¸ WDL ç»“æ„åˆ†æ

### 1. ç‰ˆæœ¬å’Œå¯¼å…¥å£°æ˜

```wdl
version 1.0

import "tasks/fastqc_task.wdl" as FastQC
import "tasks/trimmomatic_task.wdl" as Trimmomatic
import "tasks/fastp_task.wdl" as FastP
import "tasks/deduplication_task.wdl" as Dedup
import "tasks/multiqc_task.wdl" as MultiQC
```

**åŠŸèƒ½è¯´æ˜ï¼š**
- ä½¿ç”¨ WDL 1.0 è¯­æ³•æ ‡å‡†
- å¯¼å…¥ 5 ä¸ªä»»åŠ¡æ¨¡å—ï¼Œæ¯ä¸ªè´Ÿè´£ç‰¹å®šçš„é¢„å¤„ç†æ­¥éª¤
- æ¨¡å—åŒ–è®¾è®¡ä¾¿äºç»´æŠ¤å’Œé‡ç”¨

### 2. å…ƒæ•°æ®å®šä¹‰

```wdl
meta {
    description: "å®Œæ•´çš„æµ‹åºæ•°æ®é¢„å¤„ç†å·¥ä½œæµ..."
    version: "1.0"
    author: "AWS Omics Demo Project"
}

parameter_meta {
    sample_name: "æ ·æœ¬åç§°"
    fastq_r1: "æ­£å‘æµ‹åºæ–‡ä»¶ (R1)"
    fastq_r2: "åå‘æµ‹åºæ–‡ä»¶ (R2ï¼Œå¯é€‰)"
    reference_genome: "å‚è€ƒåŸºå› ç»„æ–‡ä»¶"
    adapter_fasta: "æ¥å¤´åºåˆ—æ–‡ä»¶"
    min_length: "æœ€å°è¯»é•¿é˜ˆå€¼"
    min_quality: "æœ€å°è´¨é‡åˆ†æ•°"
    threads: "å¹¶è¡Œçº¿ç¨‹æ•°"
}
```

**åŠŸèƒ½è¯´æ˜ï¼š**
- æä¾›å·¥ä½œæµæè¿°å’Œç‰ˆæœ¬ä¿¡æ¯
- ä¸ºæ¯ä¸ªè¾“å…¥å‚æ•°æä¾›ä¸­æ–‡è¯´æ˜
- ä¾¿äºç”¨æˆ·ç†è§£å‚æ•°ç”¨é€”

### 3. è¾“å…¥å‚æ•°å®šä¹‰

```wdl
input {
    String sample_name                    # æ ·æœ¬åç§°
    File fastq_r1                        # å¿…éœ€ï¼šR1 æ–‡ä»¶
    File? fastq_r2                       # å¯é€‰ï¼šR2 æ–‡ä»¶
    File? reference_genome               # å¯é€‰ï¼šå‚è€ƒåŸºå› ç»„
    File? adapter_fasta                  # å¯é€‰ï¼šæ¥å¤´åºåˆ—
    Int min_length = 50                  # é»˜è®¤ï¼šæœ€å°è¯»é•¿
    Int min_quality = 20                 # é»˜è®¤ï¼šæœ€å°è´¨é‡
    Int threads = 8                      # é»˜è®¤ï¼šçº¿ç¨‹æ•°
    Boolean paired_end = defined(fastq_r2)  # è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦åŒç«¯
}
```

**å‚æ•°ç±»å‹è¯´æ˜ï¼š**
- `String` - å­—ç¬¦ä¸²ç±»å‹ï¼Œç”¨äºæ ·æœ¬åç§°
- `File` - æ–‡ä»¶ç±»å‹ï¼Œå¿…éœ€çš„è¾“å…¥æ–‡ä»¶
- `File?` - å¯é€‰æ–‡ä»¶ç±»å‹ï¼Œå¸¦é—®å·è¡¨ç¤ºå¯é€‰
- `Int` - æ•´æ•°ç±»å‹ï¼Œç”¨äºæ•°å€¼å‚æ•°
- `Boolean` - å¸ƒå°”ç±»å‹ï¼Œè‡ªåŠ¨åˆ¤æ–­å¤„ç†æ¨¡å¼

---

## ğŸ”„ å·¥ä½œæµæ‰§è¡Œæ­¥éª¤æ¦‚è§ˆ

### æ•°æ®æµç¨‹å›¾

```
åŸå§‹ FASTQ æ–‡ä»¶ (R1, R2)
         â†“
   åˆå§‹è´¨é‡è¯„ä¼° (FastQC)
    â”œâ”€ HTML æŠ¥å‘Š
    â””â”€ ç»Ÿè®¡æ•°æ®
         â†“
   æ¥å¤´å»é™¤å’Œè´¨é‡è¿‡æ»¤ (Trimmomatic)
    â”œâ”€ å»é™¤æ¥å¤´åºåˆ—
    â”œâ”€ è´¨é‡åˆ†æ•°è¿‡æ»¤
    â””â”€ é•¿åº¦è¿‡æ»¤
         â†“
   é«˜çº§è´¨é‡è¿‡æ»¤ (fastp)
    â”œâ”€ å¤æ‚åº¦è¿‡æ»¤
    â”œâ”€ PolyG/PolyX ä¿®å‰ª
    â””â”€ è‡ªåŠ¨æ¥å¤´æ£€æµ‹
         â†“
   å»é‡å¤åºåˆ— (Deduplication)
    â”œâ”€ PCR é‡å¤å»é™¤
    â””â”€ åºåˆ—å¤šæ ·æ€§ä¿æŒ
         â†“
   æœ€ç»ˆè´¨é‡è¯„ä¼° (FastQC)
    â”œâ”€ å¤„ç†åè´¨é‡æŠ¥å‘Š
    â””â”€ è´¨é‡æ”¹å–„éªŒè¯
         â†“
   ç»¼åˆæŠ¥å‘Šç”Ÿæˆ (MultiQC)
    â”œâ”€ æ•´åˆæ‰€æœ‰æŠ¥å‘Š
    â”œâ”€ å‰åå¯¹æ¯”åˆ†æ
    â””â”€ äº¤äº’å¼å±•ç¤º
         â†“
   é¢„å¤„ç†å®Œæˆçš„é«˜è´¨é‡æ•°æ®
    â”œâ”€ æ¸…æ´çš„ FASTQ æ–‡ä»¶
    â”œâ”€ è¯¦ç»†çš„è´¨é‡æŠ¥å‘Š
    â””â”€ å¤„ç†ç»Ÿè®¡ä¿¡æ¯
```

---
# ğŸ“‹ å·¥ä½œæµæ­¥éª¤è¯¦ç»†å‚æ•°è§£æ

## ğŸ” æ­¥éª¤ 1ï¼šFastQC è´¨é‡è¯„ä¼°

### ä»»åŠ¡ï¼š`RunFastQC`

FastQC æ˜¯æµ‹åºæ•°æ®è´¨é‡è¯„ä¼°çš„æ ‡å‡†å·¥å…·ï¼Œç”¨äºç”Ÿæˆè¯¦ç»†çš„è´¨é‡æ§åˆ¶æŠ¥å‘Šã€‚

#### å·¥ä½œæµè°ƒç”¨

```wdl
call FastQC.RunFastQC as InitialQC_R1 {
    input:
        fastq_file = fastq_r1,
        sample_name = sample_name + "_R1_initial",
        threads = threads
}

if (paired_end) {
    call FastQC.RunFastQC as InitialQC_R2 {
        input:
            fastq_file = select_first([fastq_r2]),
            sample_name = sample_name + "_R2_initial",
            threads = threads
    }
}
```

#### è¾“å…¥å‚æ•°è¯¦è§£

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ | ç”¨é€” |
|--------|------|--------|------|------|
| `fastq_file` | File | å¿…éœ€ | è¾“å…¥çš„ FASTQ æ–‡ä»¶ | å¾…åˆ†æçš„æµ‹åºæ•°æ®æ–‡ä»¶ |
| `sample_name` | String | å¿…éœ€ | æ ·æœ¬åç§° | ç”¨äºè¾“å‡ºæ–‡ä»¶å‘½åå’ŒæŠ¥å‘Šæ ‡è¯† |
| `threads` | Int | 4 | å¹¶è¡Œçº¿ç¨‹æ•° | æ§åˆ¶ FastQC ä½¿ç”¨çš„ CPU æ ¸å¿ƒæ•° |
| `memory_gb` | Int | 8 | å†…å­˜éœ€æ±‚(GB) | åˆ†é…ç»™ä»»åŠ¡çš„å†…å­˜å¤§å° |
| `disk_gb` | Int | 50 | ç£ç›˜ç©ºé—´éœ€æ±‚(GB) | ä¸´æ—¶æ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶çš„å­˜å‚¨ç©ºé—´ |

#### å‚æ•°ä¼˜åŒ–å»ºè®®

**`threads` (çº¿ç¨‹æ•°)**
- **èŒƒå›´**: 1-16
- **æ¨èå€¼**: 4-8
- **å½±å“**: 
  - æ›´å¤šçº¿ç¨‹å¯ä»¥åŠ é€Ÿå¤§æ–‡ä»¶çš„å¤„ç†
  - å¯¹äºå°æ–‡ä»¶ï¼ˆ<1GBï¼‰ï¼Œå¢åŠ çº¿ç¨‹æ•°æ•ˆæœæœ‰é™
  - è¿‡å¤šçº¿ç¨‹å¯èƒ½å¯¼è‡´å†…å­˜ç«äº‰

**`memory_gb` (å†…å­˜)**
- **èŒƒå›´**: 4-32 GB
- **æ¨èå€¼**: 
  - å°æ–‡ä»¶ï¼ˆ<5GBï¼‰: 8GB
  - ä¸­ç­‰æ–‡ä»¶ï¼ˆ5-20GBï¼‰: 16GB
  - å¤§æ–‡ä»¶ï¼ˆ>20GBï¼‰: 32GB
- **å½±å“**: å†…å­˜ä¸è¶³ä¼šå¯¼è‡´ä»»åŠ¡å¤±è´¥æˆ–è¿è¡Œç¼“æ…¢

#### è¾“å‡ºæ–‡ä»¶

| æ–‡ä»¶å | æ ¼å¼ | å†…å®¹ | ç”¨é€” |
|--------|------|------|------|
| `*_fastqc.html` | HTML | å¯è§†åŒ–è´¨é‡æŠ¥å‘Š | äººå·¥æŸ¥çœ‹å’Œè´¨é‡è¯„ä¼° |
| `*_fastqc.zip` | ZIP | è¯¦ç»†ç»Ÿè®¡æ•°æ® | MultiQC æ•´åˆå’Œç¨‹åºåŒ–åˆ†æ |
| `*_summary.txt` | TXT | å…³é”®æŒ‡æ ‡æ‘˜è¦ | å¿«é€Ÿè´¨é‡æ£€æŸ¥ |

#### è´¨é‡æŒ‡æ ‡è§£è¯»

**å…³é”®æŒ‡æ ‡**:
- **æ€»åºåˆ—æ•°**: æµ‹åºæ·±åº¦æŒ‡æ ‡
- **åºåˆ—é•¿åº¦**: è¯»é•¿åˆ†å¸ƒ
- **GCå«é‡**: åŸºå› ç»„ç‰¹å¾å’Œæ±¡æŸ“æ£€æµ‹
- **è´¨é‡åˆ†æ•°åˆ†å¸ƒ**: æµ‹åºè´¨é‡è¯„ä¼°
- **é‡å¤åºåˆ—æ°´å¹³**: PCR é‡å¤å’Œè¿‡åº¦è¡¨ç¤ºåºåˆ—

---

## âœ‚ï¸ æ­¥éª¤ 2ï¼šTrimmomatic æ¥å¤´å»é™¤å’Œè´¨é‡è¿‡æ»¤

### ä»»åŠ¡ï¼š`RunTrimmomaticPE` / `RunTrimmomaticSE`

Trimmomatic æ˜¯å¹¿æ³›ä½¿ç”¨çš„æµ‹åºæ•°æ®é¢„å¤„ç†å·¥å…·ï¼Œç”¨äºå»é™¤æ¥å¤´åºåˆ—å’Œä½è´¨é‡åŒºåŸŸã€‚

#### å·¥ä½œæµè°ƒç”¨

```wdl
if (paired_end) {
    call Trimmomatic.RunTrimmomaticPE as TrimPE {
        input:
            fastq_r1 = fastq_r1,
            fastq_r2 = select_first([fastq_r2]),
            sample_name = sample_name,
            adapter_fasta = adapter_fasta,
            min_length = min_length,
            min_quality = min_quality,
            threads = threads
    }
}

if (!paired_end) {
    call Trimmomatic.RunTrimmomaticSE as TrimSE {
        input:
            fastq = fastq_r1,
            sample_name = sample_name,
            adapter_fasta = adapter_fasta,
            min_length = min_length,
            min_quality = min_quality,
            threads = threads
    }
}
```

#### è¾“å…¥å‚æ•°è¯¦è§£

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ | ç”¨é€” |
|--------|------|--------|------|------|
| `fastq_r1` | File | å¿…éœ€ | æ­£å‘æµ‹åºæ–‡ä»¶ (R1) | åŒç«¯æµ‹åºçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ |
| `fastq_r2` | File | å¿…éœ€ | åå‘æµ‹åºæ–‡ä»¶ (R2) | åŒç«¯æµ‹åºçš„ç¬¬äºŒä¸ªæ–‡ä»¶ |
| `sample_name` | String | å¿…éœ€ | æ ·æœ¬åç§° | è¾“å‡ºæ–‡ä»¶å‘½åå‰ç¼€ |
| `adapter_fasta` | File? | å¯é€‰ | æ¥å¤´åºåˆ—æ–‡ä»¶ | è‡ªå®šä¹‰æ¥å¤´åºåˆ—ï¼Œé»˜è®¤ä½¿ç”¨ TruSeq3 |
| `min_length` | Int | 50 | æœ€å°è¯»é•¿é˜ˆå€¼ | çŸ­äºæ­¤é•¿åº¦çš„è¯»æ®µå°†è¢«ä¸¢å¼ƒ |
| `min_quality` | Int | 20 | æœ€å°è´¨é‡åˆ†æ•° | æ»‘åŠ¨çª—å£è´¨é‡è¿‡æ»¤çš„é˜ˆå€¼ |
| `threads` | Int | 8 | å¹¶è¡Œçº¿ç¨‹æ•° | CPU æ ¸å¿ƒæ•° |
| `memory_gb` | Int | 16 | å†…å­˜éœ€æ±‚(GB) | å†…å­˜åˆ†é… |
| `disk_gb` | Int | 100 | ç£ç›˜ç©ºé—´éœ€æ±‚(GB) | å­˜å‚¨ç©ºé—´ |

#### å‚æ•°ä¼˜åŒ–ç­–ç•¥

**`min_length` (æœ€å°è¯»é•¿)**
- **èŒƒå›´**: 20-150 bp
- **æ¨èå€¼**: 
  - Illumina HiSeq/NovaSeq: 50-75 bp
  - Illumina MiSeq: 30-50 bp
  - é•¿è¯»é•¿å¹³å°: 100+ bp
- **å½±å“**: 
  - è¿‡ä½: ä¿ç•™ä½è´¨é‡çŸ­ç‰‡æ®µï¼Œå½±å“æ¯”å¯¹è´¨é‡
  - è¿‡é«˜: ä¸¢å¤±æœ‰ç”¨æ•°æ®ï¼Œé™ä½æµ‹åºæ·±åº¦

**`min_quality` (æœ€å°è´¨é‡åˆ†æ•°)**
- **èŒƒå›´**: 15-30
- **æ¨èå€¼**: 
  - é«˜è´¨é‡æ•°æ®: 25-30
  - æ ‡å‡†è´¨é‡: 20-25
  - ä½è´¨é‡æ•°æ®: 15-20
- **å½±å“**: 
  - è¿‡ä½: ä¿ç•™ä½è´¨é‡ç¢±åŸºï¼Œå¢åŠ é”™è¯¯ç‡
  - è¿‡é«˜: è¿‡åº¦ä¿®å‰ªï¼Œä¸¢å¤±æœ‰ç”¨ä¿¡æ¯

#### Trimmomatic å¤„ç†å‚æ•°è¯¦è§£

**æ¥å¤´å»é™¤å‚æ•° (ILLUMINACLIP)**
```bash
ILLUMINACLIP:adapter_file:2:30:10
```
- `2`: ç§å­åŒ¹é…å…è®¸çš„é”™é…æ•°
- `30`: å›æ–‡åŒ¹é…é˜ˆå€¼ï¼ˆåŒç«¯æ•°æ®æ¥å¤´åŒ¹é…ï¼‰
- `10`: ç®€å•åŒ¹é…é˜ˆå€¼ï¼ˆå•ç«¯æ¥å¤´åŒ¹é…ï¼‰

**è´¨é‡è¿‡æ»¤å‚æ•°**
```bash
LEADING:3          # å»é™¤å¼€å¤´è´¨é‡<3çš„ç¢±åŸº
TRAILING:3         # å»é™¤ç»“å°¾è´¨é‡<3çš„ç¢±åŸº
SLIDINGWINDOW:4:20 # æ»‘åŠ¨çª—å£(4bp)å¹³å‡è´¨é‡<20æ—¶ä¿®å‰ª
MINLEN:50          # æœ€å°é•¿åº¦è¿‡æ»¤
```

#### è¾“å‡ºæ–‡ä»¶

| æ–‡ä»¶å | å†…å®¹ | ç”¨é€” |
|--------|------|------|
| `*_R1_paired.fastq.gz` | é…å¯¹çš„ R1 è¯»æ®µ | ä¸»è¦è¾“å‡ºï¼Œç”¨äºä¸‹æ¸¸åˆ†æ |
| `*_R2_paired.fastq.gz` | é…å¯¹çš„ R2 è¯»æ®µ | ä¸»è¦è¾“å‡ºï¼Œç”¨äºä¸‹æ¸¸åˆ†æ |
| `*_R1_unpaired.fastq.gz` | æœªé…å¯¹çš„ R1 è¯»æ®µ | è´¨é‡æ§åˆ¶å‚è€ƒ |
| `*_R2_unpaired.fastq.gz` | æœªé…å¯¹çš„ R2 è¯»æ®µ | è´¨é‡æ§åˆ¶å‚è€ƒ |
| `*_trimmomatic.log` | å¤„ç†æ—¥å¿— | ç»Ÿè®¡ä¿¡æ¯å’Œé”™è¯¯è¯Šæ–­ |

---
## ğŸš€ æ­¥éª¤ 3ï¼šFastP é«˜çº§è´¨é‡è¿‡æ»¤

### ä»»åŠ¡ï¼š`RunFastPPE` / `RunFastPSE`

FastP æ˜¯æ–°ä¸€ä»£çš„æµ‹åºæ•°æ®é¢„å¤„ç†å·¥å…·ï¼Œæä¾›æ¯” Trimmomatic æ›´ç²¾ç»†çš„æ§åˆ¶å’Œæ›´å¿«çš„å¤„ç†é€Ÿåº¦ã€‚

#### å·¥ä½œæµè°ƒç”¨

```wdl
if (paired_end) {
    call FastP.RunFastPPE as FastPPE {
        input:
            fastq_r1 = select_first([TrimPE.trimmed_r1]),
            fastq_r2 = select_first([TrimPE.trimmed_r2]),
            sample_name = sample_name,
            min_length = min_length,
            min_quality = min_quality,
            threads = threads
    }
}

if (!paired_end) {
    call FastP.RunFastPSE as FastPSE {
        input:
            fastq = select_first([TrimSE.trimmed]),
            sample_name = sample_name,
            min_length = min_length,
            min_quality = min_quality,
            threads = threads
    }
}
```

#### è¾“å…¥å‚æ•°è¯¦è§£

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ | ç”¨é€” |
|--------|------|--------|------|------|
| `fastq_r1` | File | å¿…éœ€ | æ­£å‘æµ‹åºæ–‡ä»¶ | æ¥è‡ª Trimmomatic çš„è¾“å‡º |
| `fastq_r2` | File | å¿…éœ€ | åå‘æµ‹åºæ–‡ä»¶ | æ¥è‡ª Trimmomatic çš„è¾“å‡º |
| `sample_name` | String | å¿…éœ€ | æ ·æœ¬åç§° | æ–‡ä»¶å‘½å |
| `min_length` | Int | 50 | æœ€å°è¯»é•¿é˜ˆå€¼ | é•¿åº¦è¿‡æ»¤ |
| `min_quality` | Int | 20 | æœ€å°è´¨é‡åˆ†æ•° | è´¨é‡è¿‡æ»¤ |
| `threads` | Int | 8 | å¹¶è¡Œçº¿ç¨‹æ•° | æ€§èƒ½æ§åˆ¶ |
| `max_length` | Int | 500 | æœ€å¤§è¯»é•¿é˜ˆå€¼ | å»é™¤å¼‚å¸¸é•¿çš„è¯»æ®µ |
| `complexity_threshold` | Int | 30 | å¤æ‚åº¦é˜ˆå€¼ | ä½å¤æ‚åº¦åºåˆ—è¿‡æ»¤ |
| `enable_polyg_trimming` | Boolean | true | å¯ç”¨ PolyG ä¿®å‰ª | å»é™¤ NovaSeq çš„ PolyG å°¾éƒ¨ |
| `enable_polyx_trimming` | Boolean | true | å¯ç”¨ PolyX ä¿®å‰ª | å»é™¤åŒèšç‰©å°¾éƒ¨ |

#### é«˜çº§å‚æ•°è¯¦è§£

**`max_length` (æœ€å¤§è¯»é•¿)**
- **èŒƒå›´**: 200-1000 bp
- **æ¨èå€¼**: 
  - Illumina 150bp PE: 300-400 bp
  - Illumina 250bp PE: 500-600 bp
- **å½±å“**: å»é™¤å¼‚å¸¸é•¿çš„è¯»æ®µï¼Œé€šå¸¸æ˜¯æ¥å¤´äºŒèšä½“æˆ–å…¶ä»–äººå·¥äº§ç‰©

**`complexity_threshold` (å¤æ‚åº¦é˜ˆå€¼)**
- **èŒƒå›´**: 10-50
- **æ¨èå€¼**: 
  - ä¸¥æ ¼è¿‡æ»¤: 40-50
  - æ ‡å‡†è¿‡æ»¤: 30-40
  - å®½æ¾è¿‡æ»¤: 20-30
- **å½±å“**: 
  - è¿‡é«˜: å¯èƒ½å»é™¤çœŸå®çš„ä½å¤æ‚åº¦åŒºåŸŸï¼ˆå¦‚é‡å¤åºåˆ—ï¼‰
  - è¿‡ä½: ä¿ç•™ä½è´¨é‡çš„åŒèšç‰©åºåˆ—

**PolyG/PolyX ä¿®å‰ª**
- **PolyG**: NovaSeq å¹³å°ç‰¹æœ‰çš„é—®é¢˜ï¼Œæš—å¾ªç¯äº§ç”Ÿè¿ç»­çš„ G
- **PolyX**: ä»»ä½•åŒèšç‰©å°¾éƒ¨ï¼ˆAAAA, TTTT, CCCC, GGGGï¼‰
- **å»ºè®®**: NovaSeq æ•°æ®å¿…é¡»å¯ç”¨ï¼Œå…¶ä»–å¹³å°å¯é€‰

#### FastP å¤„ç†é€‰é¡¹

```bash
--unqualified_percent_limit 40    # å…è®¸40%çš„ç¢±åŸºè´¨é‡ä½äºé˜ˆå€¼
--n_base_limit 5                  # å…è®¸æœ€å¤š5ä¸ªNç¢±åŸº
--low_complexity_filter           # å¯ç”¨ä½å¤æ‚åº¦è¿‡æ»¤
--overrepresentation_analysis     # è¿‡åº¦è¡¨ç¤ºåºåˆ—åˆ†æ
```

#### è¾“å‡ºæ–‡ä»¶

| æ–‡ä»¶å | æ ¼å¼ | å†…å®¹ | ç”¨é€” |
|--------|------|------|------|
| `*_R1_filtered.fastq.gz` | FASTQ | è¿‡æ»¤åçš„ R1 æ•°æ® | ä¸»è¦è¾“å‡º |
| `*_R2_filtered.fastq.gz` | FASTQ | è¿‡æ»¤åçš„ R2 æ•°æ® | ä¸»è¦è¾“å‡º |
| `*_fastp.html` | HTML | è¯¦ç»†çš„å¤„ç†æŠ¥å‘Š | è´¨é‡è¯„ä¼°å’Œå¯è§†åŒ– |
| `*_fastp.json` | JSON | æœºå™¨å¯è¯»çš„ç»Ÿè®¡æ•°æ® | ç¨‹åºåŒ–åˆ†æ |

#### è´¨é‡æ”¹å–„æŒ‡æ ‡

FastP æŠ¥å‘Šä¸­çš„å…³é”®æŒ‡æ ‡ï¼š
- **è¯»æ®µä¿ç•™ç‡**: å¤„ç†åä¿ç•™çš„è¯»æ®µç™¾åˆ†æ¯”
- **ç¢±åŸºä¿ç•™ç‡**: å¤„ç†åä¿ç•™çš„ç¢±åŸºç™¾åˆ†æ¯”
- **Q30 æ”¹å–„**: è´¨é‡åˆ†æ•°â‰¥30çš„ç¢±åŸºæ¯”ä¾‹å˜åŒ–
- **GC å«é‡ç¨³å®šæ€§**: å¤„ç†å‰å GC å«é‡å˜åŒ–
- **é•¿åº¦åˆ†å¸ƒ**: è¯»æ®µé•¿åº¦åˆ†å¸ƒçš„å˜åŒ–

---

## ğŸ”„ æ­¥éª¤ 4ï¼šå»é‡å¤åºåˆ—å¤„ç†

### ä»»åŠ¡ï¼š`RemoveDuplicatesPE` / `RemoveDuplicatesSE`

å»é‡å¤å¤„ç†ç”¨äºç§»é™¤ PCR é‡å¤å’Œå…‰å­¦é‡å¤ï¼Œæé«˜æ•°æ®è´¨é‡å’Œåˆ†ææ•ˆç‡ã€‚

#### å·¥ä½œæµè°ƒç”¨

```wdl
if (paired_end) {
    call Dedup.RemoveDuplicatesPE as DedupPE {
        input:
            fastq_r1 = select_first([FastPPE.filtered_r1]),
            fastq_r2 = select_first([FastPPE.filtered_r2]),
            sample_name = sample_name,
            threads = threads
    }
}

if (!paired_end) {
    call Dedup.RemoveDuplicatesSE as DedupSE {
        input:
            fastq = select_first([FastPSE.filtered]),
            sample_name = sample_name,
            threads = threads
    }
}
```

#### è¾“å…¥å‚æ•°è¯¦è§£

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ | ç”¨é€” |
|--------|------|--------|------|------|
| `fastq_r1` | File | å¿…éœ€ | è¿‡æ»¤åçš„ R1 æ–‡ä»¶ | æ¥è‡ª FastP çš„è¾“å‡º |
| `fastq_r2` | File | å¿…éœ€ | è¿‡æ»¤åçš„ R2 æ–‡ä»¶ | æ¥è‡ª FastP çš„è¾“å‡º |
| `sample_name` | String | å¿…éœ€ | æ ·æœ¬åç§° | æ–‡ä»¶å‘½å |
| `threads` | Int | 8 | å¹¶è¡Œçº¿ç¨‹æ•° | æ€§èƒ½æ§åˆ¶ |
| `method` | String | "fastuniq" | å»é‡å¤æ–¹æ³• | ç®—æ³•é€‰æ‹© |
| `memory_gb` | Int | 16 | å†…å­˜éœ€æ±‚ | èµ„æºåˆ†é… |

#### å»é‡å¤æ–¹æ³•å¯¹æ¯”

**1. FastUniq**
- **åŸç†**: åŸºäºåºåˆ—å®Œå…¨åŒ¹é…
- **ä¼˜ç‚¹**: 
  - ä¸“ä¸ºåŒç«¯æ•°æ®è®¾è®¡
  - ä¿æŒé…å¯¹å…³ç³»
  - å¤„ç†é€Ÿåº¦å¿«
- **ç¼ºç‚¹**: 
  - åªèƒ½æ£€æµ‹å®Œå…¨ç›¸åŒçš„é‡å¤
  - å†…å­˜ä½¿ç”¨è¾ƒé«˜
- **é€‚ç”¨**: æ ‡å‡† Illumina åŒç«¯æ•°æ®

**2. Clumpify (BBTools)**
- **åŸç†**: åŸºäº k-mer èšç±»
- **ä¼˜ç‚¹**: 
  - å¯æ£€æµ‹è¿‘ä¼¼é‡å¤
  - æ”¯æŒå…‰å­¦é‡å¤æ£€æµ‹
  - å†…å­˜æ•ˆç‡é«˜
- **ç¼ºç‚¹**: 
  - å‚æ•°è°ƒä¼˜å¤æ‚
  - å¯èƒ½è¿‡åº¦å»é‡
- **é€‚ç”¨**: é«˜æ·±åº¦æµ‹åºæ•°æ®

**3. SeqKit**
- **åŸç†**: åŸºäºåºåˆ—å“ˆå¸Œ
- **ä¼˜ç‚¹**: 
  - å¤„ç†é€Ÿåº¦æå¿«
  - å†…å­˜ä½¿ç”¨ä½
  - æ”¯æŒå¤šç§è¾“å…¥æ ¼å¼
- **ç¼ºç‚¹**: 
  - ä¸»è¦ç”¨äºå•ç«¯æ•°æ®
  - åŒç«¯é…å¯¹å¤„ç†è¾ƒå¼±
- **é€‚ç”¨**: å•ç«¯æ•°æ®æˆ–é¢„å¤„ç†åçš„æ•°æ®

#### æ–¹æ³•é€‰æ‹©å»ºè®®

**æ ¹æ®æ•°æ®ç±»å‹é€‰æ‹©æ–¹æ³•**:
```json
{
  "åŒç«¯é«˜è´¨é‡æ•°æ®": "fastuniq",
  "é«˜æ·±åº¦æ•°æ®": "clumpify", 
  "å•ç«¯æ•°æ®": "seqkit",
  "å†…å­˜å—é™ç¯å¢ƒ": "seqkit"
}
```

**æ ¹æ®é‡å¤ç‡é€‰æ‹©ç­–ç•¥**:
- **ä½é‡å¤ç‡ (<10%)**: ä½¿ç”¨ FastUniqï¼Œå¿«é€Ÿå¤„ç†
- **ä¸­ç­‰é‡å¤ç‡ (10-30%)**: ä½¿ç”¨ Clumpifyï¼Œå¹³è¡¡æ•ˆæœå’Œé€Ÿåº¦
- **é«˜é‡å¤ç‡ (>30%)**: ä½¿ç”¨ Clumpify çš„ä¸¥æ ¼æ¨¡å¼

#### è¾“å‡ºæ–‡ä»¶

| æ–‡ä»¶å | å†…å®¹ | ç»Ÿè®¡ä¿¡æ¯ |
|--------|------|----------|
| `*_R1_dedup.fastq.gz` | å»é‡å¤åçš„ R1 æ•°æ® | ä¸»è¦è¾“å‡º |
| `*_R2_dedup.fastq.gz` | å»é‡å¤åçš„ R2 æ•°æ® | ä¸»è¦è¾“å‡º |
| `*_dedup_summary.txt` | å¤„ç†ç»Ÿè®¡æŠ¥å‘Š | é‡å¤ç‡ã€ä¿ç•™ç‡ç­‰ |

#### é‡å¤ç‡è§£è¯»

**æ­£å¸¸é‡å¤ç‡èŒƒå›´**:
- **åŸºå› ç»„ DNA**: 5-15%
- **è½¬å½•ç»„ RNA**: 10-30%
- **ChIP-seq**: 15-40%
- **ATAC-seq**: 20-50%

**å¼‚å¸¸é‡å¤ç‡**:
- **>50%**: å¯èƒ½çš„ PCR è¿‡åº¦æ‰©å¢æˆ–æ–‡åº“è´¨é‡é—®é¢˜
- **<5%**: å¯èƒ½çš„æµ‹åºæ·±åº¦ä¸è¶³æˆ–æ ·æœ¬è´¨é‡æé«˜

---
## ğŸ“Š æ­¥éª¤ 5ï¼šMultiQC ç»¼åˆæŠ¥å‘Š

### ä»»åŠ¡ï¼š`RunMultiQC`

MultiQC æ•´åˆæ‰€æœ‰è´¨é‡æ§åˆ¶å·¥å…·çš„è¾“å‡ºï¼Œç”Ÿæˆç»Ÿä¸€çš„ HTML æŠ¥å‘Šã€‚

#### å·¥ä½œæµè°ƒç”¨

```wdl
Array[File] all_qc_reports = flatten([
    [InitialQC_R1.fastqc_html, InitialQC_R1.fastqc_zip],
    select_all([InitialQC_R2.fastqc_html, InitialQC_R2.fastqc_zip]),
    [FinalQC_R1.fastqc_html, FinalQC_R1.fastqc_zip],
    select_all([FinalQC_R2.fastqc_html, FinalQC_R2.fastqc_zip]),
    select_all([FastPPE.fastp_html, FastPPE.fastp_json, FastPSE.fastp_html, FastPSE.fastp_json])
])

call MultiQC.RunMultiQC as GenerateReport {
    input:
        input_files = all_qc_reports,
        sample_name = sample_name,
        output_name = sample_name + "_preprocessing_report"
}
```

#### è¾“å…¥å‚æ•°è¯¦è§£

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ | ç”¨é€” |
|--------|------|--------|------|------|
| `input_files` | Array[File] | å¿…éœ€ | æ‰€æœ‰ QC å·¥å…·è¾“å‡º | æŠ¥å‘Šæ•´åˆçš„æ•°æ®æº |
| `sample_name` | String | å¿…éœ€ | æ ·æœ¬åç§° | æŠ¥å‘Šæ ‡é¢˜å’Œæ ‡è¯† |
| `output_name` | String | å¿…éœ€ | è¾“å‡ºæŠ¥å‘Šåç§° | è¾“å‡ºæ–‡ä»¶å‘½å |
| `memory_gb` | Int | 8 | å†…å­˜éœ€æ±‚ | èµ„æºåˆ†é… |

#### æŠ¥å‘Šæ¨¡å—

MultiQC è‡ªåŠ¨æ£€æµ‹å¹¶æ•´åˆä»¥ä¸‹æ¨¡å—ï¼š

**1. FastQC æ¨¡å—**
- åŸå§‹æ•°æ®è´¨é‡è¯„ä¼°
- æœ€ç»ˆæ•°æ®è´¨é‡è¯„ä¼°
- è´¨é‡æ”¹å–„å¯¹æ¯”

**2. Trimmomatic æ¨¡å—**
- æ¥å¤´å»é™¤ç»Ÿè®¡
- è´¨é‡è¿‡æ»¤æ•ˆæœ
- è¯»æ®µä¿ç•™ç‡

**3. FastP æ¨¡å—**
- é«˜çº§è¿‡æ»¤ç»Ÿè®¡
- é•¿åº¦åˆ†å¸ƒå˜åŒ–
- è´¨é‡åˆ†æ•°æ”¹å–„

**4. è‡ªå®šä¹‰ç»Ÿè®¡**
- å»é‡å¤å¤„ç†æ•ˆæœ
- æ•´ä½“æ•°æ®æµå¤±ç»Ÿè®¡
- å¤„ç†æ­¥éª¤æ€»ç»“

#### é…ç½®é€‰é¡¹

**æ ·æœ¬åç§°æ¸…ç†**:
```yaml
sample_names_rename:
    - ["_R1_initial", " (R1 åŸå§‹)"]
    - ["_R2_initial", " (R2 åŸå§‹)"]
    - ["_R1_final", " (R1 æœ€ç»ˆ)"]
    - ["_R2_final", " (R2 æœ€ç»ˆ)"]
```

**æ¨¡å—æ˜¾ç¤ºé¡ºåº**:
```yaml
module_order:
    - fastqc:
        name: "FastQC (åŸå§‹æ•°æ®)"
    - trimmomatic
    - fastp
    - fastqc:
        name: "FastQC (æœ€ç»ˆæ•°æ®)"
```

#### è¾“å‡ºæ–‡ä»¶

| æ–‡ä»¶å | æ ¼å¼ | å†…å®¹ | ç”¨é€” |
|--------|------|------|------|
| `*_report.html` | HTML | äº¤äº’å¼ç»¼åˆæŠ¥å‘Š | äººå·¥æŸ¥çœ‹å’Œåˆ†äº« |
| `*_data.zip` | ZIP | åŸå§‹æ•°æ®å’Œå›¾è¡¨ | è¿›ä¸€æ­¥åˆ†æå’Œè‡ªå®šä¹‰ |
| `*_summary.txt` | TXT | æŠ¥å‘Šç”Ÿæˆæ‘˜è¦ | å¿«é€Ÿæ£€æŸ¥ |

---

# âš™ï¸ èµ„æºé…ç½®å’Œä¼˜åŒ–

## è®¡ç®—èµ„æºé…ç½®

### èµ„æºéœ€æ±‚è¡¨

| æ•°æ®å¤§å° | CPU æ ¸å¿ƒ | å†…å­˜ (GB) | ç£ç›˜ (GB) | é¢„ä¼°æ—¶é—´ | æˆæœ¬ä¼°ç®— |
|---------|---------|-----------|-----------|----------|----------|
| **å°å‹** (<10GB) | 8-16 | 32-64 | 100-200 | 1-2 å°æ—¶ | $5-15 |
| **ä¸­å‹** (10-50GB) | 16-32 | 64-128 | 200-500 | 2-4 å°æ—¶ | $15-40 |
| **å¤§å‹** (50-100GB) | 32-64 | 128-256 | 500-1000 | 4-8 å°æ—¶ | $40-100 |
| **è¶…å¤§å‹** (>100GB) | 64+ | 256+ | 1000+ | 8+ å°æ—¶ | $100+ |

### å„æ­¥éª¤èµ„æºåˆ†é…

| å¤„ç†æ­¥éª¤ | CPU æ ¸å¿ƒ | å†…å­˜ (GB) | å­˜å‚¨ (GB) | é¢„ä¼°æ—¶é—´ |
|---------|---------|-----------|-----------|----------|
| FastQC | 2-4 | 4-8 | 10 | 10-30 åˆ†é’Ÿ |
| Trimmomatic | 4-8 | 8-16 | 20 | 30-60 åˆ†é’Ÿ |
| fastp | 4-8 | 8-16 | 20 | 20-40 åˆ†é’Ÿ |
| Deduplication | 4-8 | 16-32 | 30 | 20-60 åˆ†é’Ÿ |
| MultiQC | 1-2 | 4-8 | 5 | 5-10 åˆ†é’Ÿ |

## æˆæœ¬ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨æŠ¢å å¼å®ä¾‹
```wdl
runtime {
    preemptible: 2    # æœ€å¤šé‡è¯•2æ¬¡
    maxRetries: 1     # å¤±è´¥åé‡è¯•1æ¬¡
}
```

### 2. ç£ç›˜ç±»å‹é€‰æ‹©
- **SSD**: é«˜ I/O å¯†é›†å‹ä»»åŠ¡ï¼ˆFastQC, MultiQCï¼‰
- **HDD**: å­˜å‚¨å¯†é›†å‹ä»»åŠ¡ï¼ˆå¤§æ–‡ä»¶å¤„ç†ï¼‰

### 3. å†…å­˜ä¼˜åŒ–
- æ ¹æ®å®é™…æ•°æ®å¤§å°è°ƒæ•´å†…å­˜åˆ†é…
- é¿å…è¿‡åº¦åˆ†é…å¯¼è‡´çš„èµ„æºæµªè´¹

---

# ğŸ¯ å‚æ•°ä¼˜åŒ–ç­–ç•¥

## æ ¹æ®æ•°æ®è´¨é‡è°ƒæ•´

### é«˜è´¨é‡æ•°æ® (Q30 > 90%)
```json
{
  "PreprocessingWorkflow.min_quality": 25,
  "PreprocessingWorkflow.min_length": 75,
  "PreprocessingWorkflow.RunFastPPE.complexity_threshold": 40,
  "PreprocessingWorkflow.RunTrimmomaticPE.memory_gb": 16
}
```

### ä¸­ç­‰è´¨é‡æ•°æ® (Q30 = 70-90%)
```json
{
  "PreprocessingWorkflow.min_quality": 20,
  "PreprocessingWorkflow.min_length": 50,
  "PreprocessingWorkflow.RunFastPPE.complexity_threshold": 30,
  "PreprocessingWorkflow.RunTrimmomaticPE.memory_gb": 16
}
```

### ä½è´¨é‡æ•°æ® (Q30 < 70%)
```json
{
  "PreprocessingWorkflow.min_quality": 15,
  "PreprocessingWorkflow.min_length": 30,
  "PreprocessingWorkflow.RunFastPPE.complexity_threshold": 20,
  "PreprocessingWorkflow.RunTrimmomaticPE.memory_gb": 32
}
```

## æ ¹æ®åº”ç”¨åœºæ™¯è°ƒæ•´

### åŸºå› ç»„é‡æµ‹åº
- ä¿å®ˆçš„è´¨é‡è¿‡æ»¤
- ä¿ç•™æ›´å¤šæ•°æ®ç”¨äºå˜å¼‚æ£€æµ‹
- é‡å¤ç‡æ§åˆ¶åœ¨ 15% ä»¥ä¸‹

```json
{
  "PreprocessingWorkflow.min_quality": 20,
  "PreprocessingWorkflow.min_length": 50,
  "PreprocessingWorkflow.RemoveDuplicatesPE.method": "fastuniq"
}
```

### è½¬å½•ç»„æµ‹åº
- é€‚ä¸­çš„è´¨é‡è¿‡æ»¤
- æ³¨æ„ä¿ç•™ä½è¡¨è¾¾åŸºå› çš„æ•°æ®
- é‡å¤ç‡å¯æ¥å— 20-30%

```json
{
  "PreprocessingWorkflow.min_quality": 18,
  "PreprocessingWorkflow.min_length": 40,
  "PreprocessingWorkflow.RemoveDuplicatesPE.method": "clumpify"
}
```

### ç›®æ ‡åŒºåŸŸæµ‹åº
- ä¸¥æ ¼çš„è´¨é‡è¿‡æ»¤
- æœ€å¤§åŒ–ç›®æ ‡åŒºåŸŸçš„è¦†ç›–è´¨é‡
- é‡å¤ç‡æ§åˆ¶åœ¨ 10% ä»¥ä¸‹

```json
{
  "PreprocessingWorkflow.min_quality": 25,
  "PreprocessingWorkflow.min_length": 75,
  "PreprocessingWorkflow.RemoveDuplicatesPE.method": "fastuniq"
}
```

---

# ğŸ” è´¨é‡æ§åˆ¶æ£€æŸ¥ç‚¹

## æ¯ä¸ªæ­¥éª¤çš„å…³é”®æŒ‡æ ‡

### FastQC æ£€æŸ¥
- [ ] æ€»åºåˆ—æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸ
- [ ] è´¨é‡åˆ†æ•°åˆ†å¸ƒæ˜¯å¦æ­£å¸¸
- [ ] GC å«é‡æ˜¯å¦åœ¨åˆç†èŒƒå›´
- [ ] æ˜¯å¦å­˜åœ¨æ¥å¤´æ±¡æŸ“

### Trimmomatic æ£€æŸ¥
- [ ] é…å¯¹è¯»æ®µä¿ç•™ç‡ >80%
- [ ] æ¥å¤´å»é™¤æ˜¯å¦å½»åº•
- [ ] è´¨é‡è¿‡æ»¤æ˜¯å¦é€‚åº¦

### FastP æ£€æŸ¥
- [ ] Q30 æ¯”ä¾‹æ˜¯å¦æå‡
- [ ] é•¿åº¦åˆ†å¸ƒæ˜¯å¦åˆç†
- [ ] å¤æ‚åº¦è¿‡æ»¤æ˜¯å¦é€‚å½“

### å»é‡å¤æ£€æŸ¥
- [ ] é‡å¤ç‡æ˜¯å¦åœ¨é¢„æœŸèŒƒå›´
- [ ] æ•°æ®æŸå¤±æ˜¯å¦å¯æ¥å—
- [ ] é…å¯¹å…³ç³»æ˜¯å¦ä¿æŒ

### MultiQC æ£€æŸ¥
- [ ] æ‰€æœ‰æ¨¡å—æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
- [ ] è´¨é‡æ”¹å–„è¶‹åŠ¿æ˜¯å¦æ˜æ˜¾
- [ ] å¼‚å¸¸æ ·æœ¬æ˜¯å¦éœ€è¦é‡æ–°å¤„ç†

---
# ğŸ› ï¸ æ•…éšœæ’é™¤æŒ‡å—

## å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 1. å†…å­˜ä¸è¶³é”™è¯¯
**ç—‡çŠ¶**: 
```
OutOfMemoryError: Java heap space
Task failed with exit code 137
```

**è§£å†³æ–¹æ¡ˆ**:
- å¢åŠ  `memory_gb` å‚æ•°
- å‡å°‘ `threads` å‚æ•°
- ä½¿ç”¨æ›´å¤§çš„å®ä¾‹ç±»å‹
- æ£€æŸ¥è¾“å…¥æ–‡ä»¶å¤§å°æ˜¯å¦å¼‚å¸¸

### 2. ç£ç›˜ç©ºé—´ä¸è¶³
**ç—‡çŠ¶**:
```
No space left on device
Disk quota exceeded
```

**è§£å†³æ–¹æ¡ˆ**:
- å¢åŠ  `disk_gb` å‚æ•°
- æ¸…ç†ä¸­é—´æ–‡ä»¶
- ä½¿ç”¨æµå¼å¤„ç†
- æ£€æŸ¥ä¸´æ—¶æ–‡ä»¶ç´¯ç§¯

### 3. è´¨é‡è¿‡æ»¤è¿‡äºä¸¥æ ¼
**ç—‡çŠ¶**: æ•°æ®æŸå¤± >50%

**è§£å†³æ–¹æ¡ˆ**:
- é™ä½ `min_quality` å‚æ•° (20 â†’ 15)
- å‡å°‘ `min_length` å‚æ•° (50 â†’ 30)
- è°ƒæ•´å¤æ‚åº¦é˜ˆå€¼ (30 â†’ 20)
- æ£€æŸ¥åŸå§‹æ•°æ®è´¨é‡

### 4. å»é‡å¤æ•ˆæœä¸ä½³
**ç—‡çŠ¶**: é‡å¤ç‡ä»ç„¶å¾ˆé«˜

**è§£å†³æ–¹æ¡ˆ**:
- æ›´æ¢å»é‡å¤æ–¹æ³• (fastuniq â†’ clumpify)
- æ£€æŸ¥ä¸Šæ¸¸å¤„ç†è´¨é‡
- è€ƒè™‘æ ·æœ¬æœ¬èº«çš„ç‰¹æ€§
- è°ƒæ•´å»é‡å¤å‚æ•°

### 5. å·¥ä½œæµæ‰§è¡Œè¶…æ—¶
**ç—‡çŠ¶**: ä»»åŠ¡è¿è¡Œæ—¶é—´è¿‡é•¿

**è§£å†³æ–¹æ¡ˆ**:
- å¢åŠ  `threads` å‚æ•°
- ä¼˜åŒ–èµ„æºåˆ†é…
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- åˆ†æ‰¹å¤„ç†å¤§æ–‡ä»¶

### 6. æ–‡ä»¶æ ¼å¼é”™è¯¯
**ç—‡çŠ¶**: 
```
Invalid FASTQ format
Unexpected file format
```

**è§£å†³æ–¹æ¡ˆ**:
- éªŒè¯è¾“å…¥æ–‡ä»¶æ ¼å¼
- æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
- ç¡®è®¤å‹ç¼©æ ¼å¼æ­£ç¡®
- é‡æ–°ä¸‹è½½æŸåçš„æ–‡ä»¶

---

# ğŸ“Š æ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜

## ç›‘æ§æŒ‡æ ‡

### ç³»ç»Ÿèµ„æºç›‘æ§
- **CPU ä½¿ç”¨ç‡**: åº”ä¿æŒåœ¨ 80-90%
- **å†…å­˜ä½¿ç”¨ç‡**: é¿å…è¶…è¿‡ 90%
- **ç£ç›˜ I/O**: ç›‘æ§è¯»å†™é€Ÿåº¦
- **ç½‘ç»œå¸¦å®½**: S3 ä¼ è¾“é€Ÿåº¦

### ä»»åŠ¡æ‰§è¡Œç›‘æ§
- **ä»»åŠ¡å®Œæˆæ—¶é—´**: ä¸é¢„æœŸæ—¶é—´å¯¹æ¯”
- **æ•°æ®ä¿ç•™ç‡**: æ¯æ­¥éª¤çš„æ•°æ®æŸå¤±
- **è´¨é‡æ”¹å–„ç¨‹åº¦**: Q30 æ¯”ä¾‹å˜åŒ–
- **é”™è¯¯ç‡**: å¤±è´¥ä»»åŠ¡æ¯”ä¾‹

## æ€§èƒ½è°ƒä¼˜å»ºè®®

### 1. å¹¶è¡Œåº¦ä¼˜åŒ–
```json
{
  "å°æ–‡ä»¶ (<5GB)": {"threads": 4},
  "ä¸­ç­‰æ–‡ä»¶ (5-20GB)": {"threads": 8},
  "å¤§æ–‡ä»¶ (>20GB)": {"threads": 16}
}
```

### 2. å†…å­˜åˆ†é…ä¼˜åŒ–
```json
{
  "FastQC": "æ•°æ®å¤§å° Ã— 0.5",
  "Trimmomatic": "æ•°æ®å¤§å° Ã— 1.0", 
  "FastP": "æ•°æ®å¤§å° Ã— 0.8",
  "Deduplication": "æ•°æ®å¤§å° Ã— 1.5"
}
```

### 3. ç£ç›˜ç©ºé—´è§„åˆ’
```json
{
  "ä¸´æ—¶ç©ºé—´": "è¾“å…¥æ•°æ®å¤§å° Ã— 3",
  "è¾“å‡ºç©ºé—´": "è¾“å…¥æ•°æ®å¤§å° Ã— 1.5",
  "ç¼“å†²ç©ºé—´": "æ€»éœ€æ±‚ Ã— 0.2"
}
```

---

# ğŸ“ é…ç½®ç¤ºä¾‹

## å®Œæ•´é…ç½®ç¤ºä¾‹

### åŒç«¯æµ‹åºé«˜è´¨é‡æ•°æ®
```json
{
  "PreprocessingWorkflow.sample_name": "SRR16760538",
  "PreprocessingWorkflow.fastq_r1": "s3://catface996-genomic/sequencing-data/SRR16760538_1.fastq.gz",
  "PreprocessingWorkflow.fastq_r2": "s3://catface996-genomic/sequencing-data/SRR16760538_2.fastq.gz",
  "PreprocessingWorkflow.reference_genome": "s3://catface996-genomic/reference-genome/GCF_002263795.1_ARS-UCD1.2_genomic.fna",
  "PreprocessingWorkflow.min_length": 75,
  "PreprocessingWorkflow.min_quality": 25,
  "PreprocessingWorkflow.threads": 16,
  "PreprocessingWorkflow.paired_end": true,
  
  "PreprocessingWorkflow.RunFastQC.memory_gb": 16,
  "PreprocessingWorkflow.RunTrimmomaticPE.memory_gb": 32,
  "PreprocessingWorkflow.RunFastPPE.memory_gb": 32,
  "PreprocessingWorkflow.RunFastPPE.max_length": 400,
  "PreprocessingWorkflow.RunFastPPE.complexity_threshold": 40,
  "PreprocessingWorkflow.RunFastPPE.enable_polyg_trimming": true,
  "PreprocessingWorkflow.RunFastPPE.enable_polyx_trimming": true,
  "PreprocessingWorkflow.RemoveDuplicatesPE.memory_gb": 32,
  "PreprocessingWorkflow.RemoveDuplicatesPE.method": "fastuniq",
  "PreprocessingWorkflow.RunMultiQC.memory_gb": 16
}
```

### ä½è´¨é‡æ•°æ®å®½æ¾è¿‡æ»¤
```json
{
  "PreprocessingWorkflow.sample_name": "low_quality_sample",
  "PreprocessingWorkflow.fastq_r1": "s3://bucket/low_quality_R1.fastq.gz",
  "PreprocessingWorkflow.fastq_r2": "s3://bucket/low_quality_R2.fastq.gz",
  "PreprocessingWorkflow.min_length": 30,
  "PreprocessingWorkflow.min_quality": 15,
  "PreprocessingWorkflow.threads": 8,
  
  "PreprocessingWorkflow.RunFastPPE.complexity_threshold": 20,
  "PreprocessingWorkflow.RunFastPPE.enable_polyg_trimming": false,
  "PreprocessingWorkflow.RemoveDuplicatesPE.method": "clumpify"
}
```

### å†…å­˜å—é™ç¯å¢ƒé…ç½®
```json
{
  "PreprocessingWorkflow.sample_name": "memory_limited",
  "PreprocessingWorkflow.threads": 4,
  
  "PreprocessingWorkflow.RunFastQC.memory_gb": 8,
  "PreprocessingWorkflow.RunTrimmomaticPE.memory_gb": 16,
  "PreprocessingWorkflow.RunFastPPE.memory_gb": 16,
  "PreprocessingWorkflow.RemoveDuplicatesPE.memory_gb": 16,
  "PreprocessingWorkflow.RemoveDuplicatesPE.method": "seqkit",
  "PreprocessingWorkflow.RunMultiQC.memory_gb": 8
}
```

---

# ğŸ“š å‚è€ƒèµ„æº

## å·¥å…·æ–‡æ¡£
- [FastQC ç”¨æˆ·æ‰‹å†Œ](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/)
- [Trimmomatic æ–‡æ¡£](http://www.usadellab.org/cms/?page=trimmomatic)
- [FastP GitHub](https://github.com/OpenGene/fastp)
- [MultiQC æ–‡æ¡£](https://multiqc.info/)
- [AWS Omics ç”¨æˆ·æŒ‡å—](https://docs.aws.amazon.com/omics/)

## æœ€ä½³å®è·µ
- [GATK æœ€ä½³å®è·µ](https://gatk.broadinstitute.org/hc/en-us/sections/360007226651)
- [nf-core æµæ°´çº¿](https://nf-co.re/)
- [Illumina æ•°æ®å¤„ç†æŒ‡å—](https://www.illumina.com/)

## è´¨é‡æ ‡å‡†
- [ENCODE æ•°æ®æ ‡å‡†](https://www.encodeproject.org/)
- [1000 Genomes è´¨é‡æ§åˆ¶](https://www.internationalgenome.org/)

## WDL è¯­æ³•å‚è€ƒ
- [WDL è§„èŒƒ](https://github.com/openwdl/wdl)
- [Cromwell æ–‡æ¡£](https://cromwell.readthedocs.io/)
- [Terra å¹³å°æŒ‡å—](https://terra.bio/)

---

# ğŸ“ æŠ€æœ¯æ”¯æŒ

## è·å–å¸®åŠ©

### æ–‡æ¡£å’Œæ•™ç¨‹
- æŸ¥çœ‹å·¥ä½œæµæ–‡æ¡£å’Œç¤ºä¾‹
- å‚è€ƒ AWS Omics ç”¨æˆ·æŒ‡å—
- æµè§ˆç”Ÿç‰©ä¿¡æ¯å­¦ç¤¾åŒºè®ºå›

### å¸¸è§é—®é¢˜
- æ£€æŸ¥å‚æ•°é…ç½®æ˜¯å¦æ­£ç¡®
- éªŒè¯è¾“å…¥æ–‡ä»¶æ ¼å¼å’Œè·¯å¾„
- ç¡®è®¤ AWS æƒé™è®¾ç½®

### è”ç³»æ”¯æŒ
- AWS æŠ€æœ¯æ”¯æŒ
- ç”Ÿç‰©ä¿¡æ¯å­¦ç¤¾åŒº
- é¡¹ç›®ç»´æŠ¤å›¢é˜Ÿ

---

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

**æ–‡æ¡£æ ‡é¢˜**: é¢„å¤„ç†å·¥ä½œæµå®Œæ•´æŒ‡å—  
**ç‰ˆæœ¬**: 1.0  
**ä½œè€…**: AWS Omics Demo Project  
**æœ€åæ›´æ–°**: 2025-08-09  
**é€‚ç”¨ç‰ˆæœ¬**: WDL 1.0, AWS Omics  

**æ›´æ–°å†å²**:
- v1.0 (2025-08-09): åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«å®Œæ•´çš„å·¥ä½œæµè¯´æ˜å’Œå‚æ•°è¯¦è§£

---

*æœ¬æ–‡æ¡£æä¾›äº† AWS Omics é¢„å¤„ç†å·¥ä½œæµçš„å®Œæ•´æŒ‡å—ï¼ŒåŒ…æ‹¬è¯¦ç»†çš„å‚æ•°è¯´æ˜ã€ä¼˜åŒ–å»ºè®®å’Œæ•…éšœæ’é™¤æ–¹æ³•ã€‚å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚*
