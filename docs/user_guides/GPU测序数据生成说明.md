# GPUåŠ é€Ÿæµ‹åºæ•°æ®ç”Ÿæˆå™¨ä½¿ç”¨è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

åŸºäºä½ å·²æœ‰çš„ `consolidated_variants.vcf`ï¼ˆ3,154,016ä¸ªå˜å¼‚ï¼‰å’Œå¥¶ç‰›å‚è€ƒåŸºå› ç»„ï¼Œç”Ÿæˆé«˜è´¨é‡çš„æ¨¡æ‹Ÿæµ‹åºæ•°æ®ï¼Œå……åˆ†åˆ©ç”¨Apple M4 Max GPUåŠ é€Ÿã€‚

## ğŸ“Š è¾“å…¥æ•°æ®çŠ¶æ€

- âœ… **å‚è€ƒåŸºå› ç»„**: `genomic_data/reference/GCF_002263795.1_ARS-UCD1.2_genomic.fna` (2.75GB)
- âœ… **å˜å¼‚æ•°æ®**: `consolidated_simulation_data/consolidated_variants.vcf` (230MB, 3,154,016ä¸ªå˜å¼‚)
- âœ… **GPUè®¾å¤‡**: Apple M4 Max (40æ ¸å¿ƒ) with MPSæ”¯æŒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# è¿è¡Œè‡ªåŠ¨åŒ–è„šæœ¬ï¼ŒåŒ…å«å¤šç§æ¨¡å¼é€‰æ‹©
./run_sequencing_simulation.sh
```

### æ–¹æ³•2: æ‰‹åŠ¨è¿è¡Œ
```bash
# å¿«é€Ÿæµ‹è¯• (10xè¦†ç›–åº¦, å‰3ä¸ªæŸ“è‰²ä½“)
python3 generate_sequencing_data_gpu.py \
    --reference genomic_data/reference/GCF_002263795.1_ARS-UCD1.2_genomic.fna \
    --variants consolidated_simulation_data/consolidated_variants.vcf \
    --output sequencing_data_test \
    --coverage 10 \
    --chromosomes NC_037328.1 NC_037329.1 NC_037330.1

# æ ‡å‡†æ¨¡å¼ (30xè¦†ç›–åº¦, æ‰€æœ‰ä¸»è¦æŸ“è‰²ä½“)
python3 generate_sequencing_data_gpu.py \
    --reference genomic_data/reference/GCF_002263795.1_ARS-UCD1.2_genomic.fna \
    --variants consolidated_simulation_data/consolidated_variants.vcf \
    --output sequencing_data_30x \
    --coverage 30
```

## ğŸ”§ å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|------|------|--------|------|
| `--reference` | å‚è€ƒåŸºå› ç»„FASTAæ–‡ä»¶ | å¿…éœ€ | `genomic_data/reference/GCF_002263795.1_ARS-UCD1.2_genomic.fna` |
| `--variants` | å˜å¼‚VCFæ–‡ä»¶ | å¿…éœ€ | `consolidated_simulation_data/consolidated_variants.vcf` |
| `--output` | è¾“å‡ºç›®å½• | `./sequencing_data` | `my_sequencing_data` |
| `--coverage` | æµ‹åºè¦†ç›–æ·±åº¦ | `30.0` | `10`, `30`, `50` |
| `--chromosomes` | æŒ‡å®šæŸ“è‰²ä½“åˆ—è¡¨ | æ‰€æœ‰ä¸»è¦æŸ“è‰²ä½“ | `NC_037328.1 NC_037329.1` |

## ğŸ“ˆ æ€§èƒ½é¢„æœŸ

åŸºäºä½ çš„Apple M4 Max GPUå’Œä¹‹å‰çš„æµ‹è¯•ç»“æœï¼š

### å¿«é€Ÿæµ‹è¯•æ¨¡å¼ (10xè¦†ç›–åº¦, 3ä¸ªæŸ“è‰²ä½“)
- **é¢„è®¡æ—¶é—´**: 2-3åˆ†é’Ÿ
- **ç”Ÿæˆæ•°æ®**: ~50ä¸‡å¯¹reads
- **è¾“å‡ºå¤§å°**: ~150MB FASTQæ–‡ä»¶

### æ ‡å‡†æ¨¡å¼ (30xè¦†ç›–åº¦, 30ä¸ªæŸ“è‰²ä½“)
- **é¢„è®¡æ—¶é—´**: 15-20åˆ†é’Ÿ
- **ç”Ÿæˆæ•°æ®**: ~1500ä¸‡å¯¹reads
- **è¾“å‡ºå¤§å°**: ~4.5GB FASTQæ–‡ä»¶

### é«˜è¦†ç›–åº¦æ¨¡å¼ (50xè¦†ç›–åº¦, 30ä¸ªæŸ“è‰²ä½“)
- **é¢„è®¡æ—¶é—´**: 25-30åˆ†é’Ÿ
- **ç”Ÿæˆæ•°æ®**: ~2500ä¸‡å¯¹reads
- **è¾“å‡ºå¤§å°**: ~7.5GB FASTQæ–‡ä»¶

## ğŸ“ è¾“å‡ºæ–‡ä»¶ç»“æ„

```
sequencing_data/
â”œâ”€â”€ NC_037328.1_R1.fastq.gz          # æŸ“è‰²ä½“1æ­£å‘reads
â”œâ”€â”€ NC_037328.1_R2.fastq.gz          # æŸ“è‰²ä½“1åå‘reads
â”œâ”€â”€ NC_037329.1_R1.fastq.gz          # æŸ“è‰²ä½“2æ­£å‘reads
â”œâ”€â”€ NC_037329.1_R2.fastq.gz          # æŸ“è‰²ä½“2åå‘reads
â”œâ”€â”€ ...
â””â”€â”€ sequencing_generation_report.json # è¯¦ç»†ç”ŸæˆæŠ¥å‘Š
```

## ğŸ“Š ç”Ÿæˆçš„æµ‹åºæ•°æ®ç‰¹æ€§

### æŠ€æœ¯å‚æ•°
- **è¯»é•¿**: 150bp (é…å¯¹ç«¯æµ‹åº)
- **æ’å…¥ç‰‡æ®µ**: 300Â±50bp
- **æµ‹åºé”™è¯¯ç‡**: 0.1%
- **è´¨é‡åˆ†æ•°**: Phred+33ç¼–ç 
- **æ ¼å¼**: æ ‡å‡†FASTQ.gzå‹ç¼©æ ¼å¼

### ç”Ÿç‰©å­¦ç‰¹æ€§
- **å˜å¼‚å¯†åº¦**: åŸºäºçœŸå®çš„3,154,016ä¸ªå˜å¼‚
- **å˜å¼‚ç±»å‹**: SNPå’ŒInDel
- **æŸ“è‰²ä½“è¦†ç›–**: 30ä¸ªä¸»è¦æŸ“è‰²ä½“ (NC_037328.1 - NC_037357.1)
- **åŸºå› ç»„ç‰ˆæœ¬**: ARS-UCD1.2

## ğŸ” è´¨é‡éªŒè¯

ç”Ÿæˆçš„æ•°æ®åŒ…å«ï¼š
1. **å·²çŸ¥å˜å¼‚ä½ç‚¹**: æ‰€æœ‰å˜å¼‚éƒ½æœ‰å‡†ç¡®çš„çœŸå€¼æ ‡æ³¨
2. **æµ‹åºé”™è¯¯**: æ¨¡æ‹ŸçœŸå®çš„æµ‹åºé”™è¯¯æ¨¡å¼
3. **è¦†ç›–åº¦åˆ†å¸ƒ**: ç¬¦åˆæ³Šæ¾åˆ†å¸ƒçš„è¦†ç›–åº¦
4. **é…å¯¹ä¿¡æ¯**: æ­£ç¡®çš„é…å¯¹ç«¯å…³ç³»

## ğŸ§¬ åç»­åˆ†æå»ºè®®

ç”Ÿæˆçš„æµ‹åºæ•°æ®å¯ç”¨äºï¼š

### 1. å˜å¼‚æ£€æµ‹éªŒè¯
```bash
# ä½¿ç”¨GATKè¿›è¡Œå˜å¼‚æ£€æµ‹
gatk HaplotypeCaller \
    -R reference.fna \
    -I aligned_reads.bam \
    -O detected_variants.vcf
```

### 2. AWS Omicså·¥ä½œæµæµ‹è¯•
```bash
# ä¸Šä¼ åˆ°S3å¹¶åˆ›å»ºRead Set
aws s3 sync sequencing_data/ s3://your-bucket/sequencing-data/
aws omics create-read-set \
    --sequence-store-id <store-id> \
    --sources sourceFiles=s3://your-bucket/sequencing-data/
```

### 3. å‡†ç¡®æ€§è¯„ä¼°
```bash
# æ¯”è¾ƒæ£€æµ‹åˆ°çš„å˜å¼‚ä¸çœŸå€¼
bcftools isec \
    -p comparison_results \
    consolidated_variants.vcf \
    detected_variants.vcf
```

## âš¡ GPUä¼˜åŒ–ç‰¹æ€§

### å¹¶è¡Œå¤„ç†ç­–ç•¥
- **æŸ“è‰²ä½“çº§å¹¶è¡Œ**: å¤šä¸ªæŸ“è‰²ä½“åŒæ—¶å¤„ç†
- **æ‰¹é‡å˜å¼‚åº”ç”¨**: GPUæ‰¹é‡å¤„ç†å˜å¼‚
- **å‘é‡åŒ–æ“ä½œ**: åˆ©ç”¨MPSè¿›è¡Œå‘é‡åŒ–è®¡ç®—
- **å†…å­˜ä¼˜åŒ–**: æ™ºèƒ½å†…å­˜ç®¡ç†é¿å…OOM

### æ€§èƒ½ç›‘æ§
è„šæœ¬ä¼šå®æ—¶æ˜¾ç¤ºï¼š
- GPUåˆ©ç”¨ç‡
- å¤„ç†é€Ÿåº¦ (reads/ç§’)
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- é¢„è®¡å®Œæˆæ—¶é—´

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **GPUä¸å¯ç”¨**
   ```
   è§£å†³: ç¡®ä¿macOSæ”¯æŒMPSï¼Œæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
   ```

2. **å†…å­˜ä¸è¶³**
   ```
   è§£å†³: å‡å°‘è¦†ç›–åº¦æˆ–åˆ†æ‰¹å¤„ç†æŸ“è‰²ä½“
   ```

3. **æ–‡ä»¶è·¯å¾„é”™è¯¯**
   ```
   è§£å†³: æ£€æŸ¥å‚è€ƒåŸºå› ç»„å’ŒVCFæ–‡ä»¶è·¯å¾„
   ```

### æ€§èƒ½è°ƒä¼˜

1. **æé«˜å¹¶è¡Œåº¦**
   ```python
   # ä¿®æ”¹ThreadPoolExecutorçš„max_workers
   with ThreadPoolExecutor(max_workers=8) as executor:
   ```

2. **è°ƒæ•´æ‰¹å¤„ç†å¤§å°**
   ```python
   # ä¿®æ”¹batch_sizeå‚æ•°
   batch_size = 2000  # å¢åŠ æ‰¹å¤„ç†å¤§å°
   ```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

è¿è¡Œå‰ç¡®è®¤ï¼š
- [ ] å‚è€ƒåŸºå› ç»„æ–‡ä»¶å­˜åœ¨ä¸”å®Œæ•´
- [ ] VCFæ–‡ä»¶æ ¼å¼æ­£ç¡®
- [ ] æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ (è‡³å°‘10GB)
- [ ] GPUé©±åŠ¨æ­£å¸¸å·¥ä½œ
- [ ] Pythonç¯å¢ƒåŒ…å«æ‰€éœ€ä¾èµ–

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **æ•°æ®è´¨é‡åˆ†æ**: ä½¿ç”¨FastQCåˆ†æç”Ÿæˆçš„æ•°æ®
2. **æ¯”å¯¹æµ‹è¯•**: ä½¿ç”¨BWA-MEMè¿›è¡ŒåŸºå› ç»„æ¯”å¯¹
3. **å˜å¼‚æ£€æµ‹**: è¿è¡ŒGATK HaplotypeCaller
4. **AWS Omicsé›†æˆ**: ä¸Šä¼ æ•°æ®å¹¶è¿è¡Œå·¥ä½œæµ
5. **å‡†ç¡®æ€§è¯„ä¼°**: è®¡ç®—å˜å¼‚æ£€æµ‹çš„æ•æ„Ÿæ€§å’Œç‰¹å¼‚æ€§

---

**æç¤º**: é¦–æ¬¡è¿è¡Œå»ºè®®ä½¿ç”¨å¿«é€Ÿæµ‹è¯•æ¨¡å¼ï¼Œç¡®è®¤ä¸€åˆ‡æ­£å¸¸åå†è¿è¡Œå®Œæ•´çš„æ ‡å‡†æ¨¡å¼ã€‚
