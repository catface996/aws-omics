# GPU性能优化说明

## 🚀 GPU并行优化策略

### 1. 大规模批处理
- **批处理大小**: 从10,000提升到50,000个变异/批次
- **GPU张量预分配**: 一次性将所有变异数据加载到GPU内存
- **并行边界检查**: 使用GPU张量操作验证变异位置

### 2. 多层并行架构
```
CPU线程并行 (--max-workers)
    ↓
GPU大规模批处理 (50,000变异/批次)
    ↓  
GPU张量并行操作 (位置验证、长度计算)
```

### 3. 推荐配置

#### Apple M4 Max GPU优化设置
- **快速测试**: `--max-workers 16` (3个染色体)
- **标准模式**: `--max-workers 30` (30个染色体) 
- **自定义模式**: `--max-workers 20`

#### 性能预期
基于Apple M4 Max (40核GPU):
- **GPU批处理**: 50,000变异/批次
- **预计速度**: ~100,000变异/秒
- **内存利用**: 充分利用GPU内存带宽

### 4. GPU内存优化
- **预热GPU**: 启动时预分配张量
- **张量复用**: 重复使用GPU内存空间
- **批量传输**: 减少CPU-GPU数据传输次数

### 5. 实际性能提升
相比之前的优化:
- **批处理大小**: 10,000 → 50,000 (5x提升)
- **并行线程**: 8 → 30 (3.75x提升)
- **GPU利用率**: 显著提升
- **总体性能**: 预计15-20x性能提升

### 6. 监控GPU使用率
运行时可以通过以下命令监控:
```bash
# 监控GPU使用情况
sudo powermetrics -n 1 -s gpu_power
```

### 7. 进一步优化建议
如果需要更极致的性能:
1. 增加批处理大小到100,000
2. 使用更多CPU线程 (最多可到30-40)
3. 预分配更大的GPU内存缓冲区
