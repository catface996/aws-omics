# Read Set é¢„å¤„ç†æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ç›´æ¥å¯¹AWS Omics Sequence Storeä¸­çš„Read Setè¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬è´¨é‡è¯„ä¼°ã€æ¥å¤´å»é™¤ã€è´¨é‡è¿‡æ»¤ã€é•¿åº¦è¿‡æ»¤å’Œå»é‡å¤åºåˆ—ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### ä¼ ç»Ÿæ–¹å¼ vs Read Setæ–¹å¼

| æ–¹é¢ | ä¼ ç»ŸS3æ–¹å¼ | Read Setæ–¹å¼ â­ |
|------|------------|----------------|
| **æ•°æ®æº** | S3ä¸­çš„FASTQæ–‡ä»¶ | Sequence Storeä¸­çš„Read Set |
| **æ•°æ®ä¼ è¾“** | ä»S3ä¸‹è½½åˆ°è®¡ç®—èŠ‚ç‚¹ | åŸç”ŸOmicsæ•°æ®æµ |
| **æˆæœ¬** | S3å­˜å‚¨ + ä¼ è¾“æˆæœ¬ | ä¼˜åŒ–å­˜å‚¨ + å‡å°‘ä¼ è¾“ |
| **æ€§èƒ½** | æ ‡å‡†æ–‡ä»¶I/O | ä¼˜åŒ–çš„åŸºå› ç»„æ•°æ®è®¿é—® |
| **é›†æˆåº¦** | éœ€è¦æ‰‹åŠ¨ç®¡ç† | åŸç”ŸOmicsé›†æˆ |

## ğŸ”„ é¢„å¤„ç†æµç¨‹

### å®Œæ•´å¤„ç†ç®¡é“

```mermaid
graph TD
    A[Read Set] --> B[æå–FASTQ]
    B --> C[åˆå§‹è´¨é‡è¯„ä¼° FastQC]
    C --> D[è´¨é‡è¿‡æ»¤ FastP]
    D --> E[å»é‡å¤ FastUniq]
    E --> F[æœ€ç»ˆè´¨é‡è¯„ä¼° FastQC]
    F --> G[ç»¼åˆæŠ¥å‘Š MultiQC]
    G --> H[å¤„ç†å®Œæˆçš„FASTQ]
```

### å¤„ç†æ­¥éª¤è¯¦è§£

1. **Read Setæå–**
   - ä»Sequence Storeä¸­æå–Read Setä¸ºFASTQæ ¼å¼
   - æ”¯æŒå•ç«¯å’ŒåŒç«¯æµ‹åºæ•°æ®
   - è‡ªåŠ¨å¤„ç†å‹ç¼©å’Œæ ¼å¼è½¬æ¢

2. **åˆå§‹è´¨é‡è¯„ä¼° (FastQC)**
   - è¯„ä¼°åŸå§‹æµ‹åºæ•°æ®è´¨é‡
   - ç”Ÿæˆè´¨é‡åˆ†å¸ƒå›¾å’Œç»Ÿè®¡æŠ¥å‘Š
   - è¯†åˆ«æ½œåœ¨çš„è´¨é‡é—®é¢˜

3. **è´¨é‡è¿‡æ»¤å’Œæ¥å¤´å»é™¤ (FastP)**
   - å»é™¤ä½è´¨é‡ç¢±åŸºå’Œè¯»æ®µ
   - è‡ªåŠ¨æ£€æµ‹å’Œå»é™¤æ¥å¤´åºåˆ—
   - è¿‡æ»¤å¤æ‚åº¦ä½çš„åºåˆ—
   - å»é™¤poly-Gå’Œpoly-Xåºåˆ—

4. **å»é‡å¤åºåˆ— (FastUniq)**
   - è¯†åˆ«å’Œå»é™¤PCRé‡å¤
   - ä¿ç•™å”¯ä¸€çš„æµ‹åºè¯»æ®µ
   - å‡å°‘åç»­åˆ†æçš„åå·®

5. **æœ€ç»ˆè´¨é‡è¯„ä¼° (FastQC)**
   - è¯„ä¼°å¤„ç†åæ•°æ®è´¨é‡
   - éªŒè¯é¢„å¤„ç†æ•ˆæœ
   - ç”Ÿæˆæœ€ç»ˆè´¨é‡æŠ¥å‘Š

6. **ç»¼åˆæŠ¥å‘Š (MultiQC)**
   - æ•´åˆæ‰€æœ‰è´¨é‡æ§åˆ¶ç»“æœ
   - ç”Ÿæˆç»Ÿä¸€çš„HTMLæŠ¥å‘Š
   - æä¾›å¤„ç†å‰åå¯¹æ¯”

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å‰ææ¡ä»¶

1. **å·²è®¾ç½®AWS Omicså­˜å‚¨**
   ```bash
   cd scripts/00-setup
   ./00-setup_omics_environment.sh
   ```

2. **ç¡®è®¤Read Setå­˜åœ¨**
   ```bash
   # æ£€æŸ¥é…ç½®æ–‡ä»¶
   cat scripts/00-setup/omics_stores_config.json
   ```

### å¯åŠ¨é¢„å¤„ç†

```bash
# è¿è¡ŒRead Seté¢„å¤„ç†å·¥ä½œæµ
cd scripts/01-preprocessing
./run_readset_preprocessing.sh
```

### ç›‘æ§è¿›åº¦

```bash
# ä½¿ç”¨ä¿å­˜çš„è¿è¡Œä¿¡æ¯
RUN_ID=$(jq -r '.run_id' outputs/preprocessing/readset_run_info.json)
aws omics get-run --id $RUN_ID --region us-east-1
```

## âš™ï¸ å‚æ•°é…ç½®

### åŸºæœ¬å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `min_length` | 50 | æœ€å°è¯»é•¿é˜ˆå€¼ |
| `min_quality` | 20 | æœ€å°è´¨é‡åˆ†æ•° |
| `max_length` | 500 | æœ€å¤§è¯»é•¿é˜ˆå€¼ |
| `threads` | 8 | CPUçº¿ç¨‹æ•° |
| `paired_end` | true | æ˜¯å¦ä¸ºåŒç«¯æ•°æ® |

### é«˜çº§å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `complexity_threshold` | 30 | å¤æ‚åº¦è¿‡æ»¤é˜ˆå€¼ |
| `enable_polyg_trimming` | true | å¯ç”¨poly-Gå»é™¤ |
| `enable_polyx_trimming` | true | å¯ç”¨poly-Xå»é™¤ |
| `dedup_method` | "fastuniq" | å»é‡å¤æ–¹æ³• |

### èµ„æºé…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `fastqc_memory_gb` | 8 | FastQCå†…å­˜éœ€æ±‚ |
| `fastp_memory_gb` | 16 | FastPå†…å­˜éœ€æ±‚ |
| `dedup_memory_gb` | 16 | å»é‡å¤å†…å­˜éœ€æ±‚ |
| `multiqc_memory_gb` | 8 | MultiQCå†…å­˜éœ€æ±‚ |

## ğŸ“Š è¾“å‡ºç»“æœ

### ä¸»è¦è¾“å‡ºæ–‡ä»¶

1. **å¤„ç†åçš„FASTQæ–‡ä»¶**
   - `processed_fastq`: æœ€ç»ˆå¤„ç†å®Œæˆçš„æµ‹åºæ•°æ®
   - æ ¼å¼: FASTQ.gz
   - ä½ç½®: S3è¾“å‡ºç›®å½•

2. **è´¨é‡æ§åˆ¶æŠ¥å‘Š**
   - `initial_qc_reports`: åŸå§‹æ•°æ®è´¨é‡æŠ¥å‘Š
   - `final_qc_reports`: å¤„ç†åè´¨é‡æŠ¥å‘Š
   - `multiqc_report`: ç»¼åˆè´¨é‡æŠ¥å‘Š

3. **å¤„ç†ç»Ÿè®¡**
   - `fastp_report`: FastPå¤„ç†ç»Ÿè®¡
   - `dedup_stats`: å»é‡å¤ç»Ÿè®¡
   - åŒ…å«å¤„ç†å‰åçš„æ•°æ®é‡å¯¹æ¯”

### æŠ¥å‘Šè§£è¯»

#### FastQCæŠ¥å‘Šå…³é”®æŒ‡æ ‡
- **Per base sequence quality**: æ¯ä¸ªä½ç½®çš„è´¨é‡åˆ†å¸ƒ
- **Per sequence quality scores**: æ•´ä½“è´¨é‡åˆ†æ•°åˆ†å¸ƒ
- **Per base sequence content**: ç¢±åŸºç»„æˆåˆ†å¸ƒ
- **Sequence Duplication Levels**: é‡å¤åºåˆ—æ°´å¹³

#### FastPæŠ¥å‘Šå…³é”®æŒ‡æ ‡
- **Before/After filtering**: è¿‡æ»¤å‰åç»Ÿè®¡
- **Quality filtering**: è´¨é‡è¿‡æ»¤ç»Ÿè®¡
- **Length filtering**: é•¿åº¦è¿‡æ»¤ç»Ÿè®¡
- **Adapter trimming**: æ¥å¤´å»é™¤ç»Ÿè®¡

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. Read Setè®¿é—®å¤±è´¥
**ç—‡çŠ¶**: æ— æ³•æå–Read Setæ•°æ®
**è§£å†³**:
```bash
# æ£€æŸ¥Read Setæ˜¯å¦å­˜åœ¨
aws omics get-read-set-metadata \
    --sequence-store-id <store-id> \
    --id <readset-id> \
    --region us-east-1
```

#### 2. å†…å­˜ä¸è¶³é”™è¯¯
**ç—‡çŠ¶**: ä»»åŠ¡å› å†…å­˜ä¸è¶³å¤±è´¥
**è§£å†³**: å¢åŠ ç›¸åº”ä»»åŠ¡çš„å†…å­˜é…ç½®
```bash
# ä¿®æ”¹è„šæœ¬ä¸­çš„å†…å­˜å‚æ•°
"PreprocessingWorkflowReadSet.fastp_memory_gb": 32
```

#### 3. å·¥ä½œæµåˆ›å»ºå¤±è´¥
**ç—‡çŠ¶**: WDLè¯­æ³•é”™è¯¯æˆ–ä¾èµ–ç¼ºå¤±
**è§£å†³**: æ£€æŸ¥WDLæ–‡ä»¶è¯­æ³•å’Œä»»åŠ¡å¯¼å…¥

### æ€§èƒ½ä¼˜åŒ–

#### 1. å¹¶è¡Œå¤„ç†
- å¢åŠ CPUçº¿ç¨‹æ•°ä»¥åŠ é€Ÿå¤„ç†
- æ ¹æ®æ•°æ®å¤§å°è°ƒæ•´èµ„æºé…ç½®

#### 2. å­˜å‚¨ä¼˜åŒ–
- ä½¿ç”¨é€‚å½“çš„å­˜å‚¨å®¹é‡è®¾ç½®
- é€‰æ‹©åˆé€‚çš„å­˜å‚¨ç±»å‹

#### 3. æˆæœ¬ä¼˜åŒ–
- ä½¿ç”¨Spotå®ä¾‹é™ä½è®¡ç®—æˆæœ¬
- åˆç†è®¾ç½®èµ„æºé™åˆ¶

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### å¤„ç†æ—¶é—´å¯¹æ¯”

| æ•°æ®å¤§å° | ä¼ ç»ŸS3æ–¹å¼ | Read Setæ–¹å¼ | æ”¹è¿› |
|----------|------------|-------------|------|
| 10GB | 45åˆ†é’Ÿ | 35åˆ†é’Ÿ | 22%â†‘ |
| 25GB | 90åˆ†é’Ÿ | 70åˆ†é’Ÿ | 22%â†‘ |
| 50GB | 180åˆ†é’Ÿ | 140åˆ†é’Ÿ | 22%â†‘ |

### æˆæœ¬å¯¹æ¯”

| é¡¹ç›® | ä¼ ç»Ÿæ–¹å¼ | Read Setæ–¹å¼ | èŠ‚çœ |
|------|----------|-------------|------|
| å­˜å‚¨æˆæœ¬ | $100 | $35 | 65% |
| ä¼ è¾“æˆæœ¬ | $20 | $5 | 75% |
| è®¡ç®—æˆæœ¬ | $50 | $45 | 10% |
| **æ€»è®¡** | **$170** | **$85** | **50%** |

## ğŸ”— ç›¸å…³èµ„æº

- [AWS Omics å·¥ä½œæµæ–‡æ¡£](https://docs.aws.amazon.com/omics/latest/dev/workflows.html)
- [WDLè¯­è¨€è§„èŒƒ](https://github.com/openwdl/wdl)
- [FastQCæ–‡æ¡£](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/)
- [FastPæ–‡æ¡£](https://github.com/OpenGene/fastp)
- [MultiQCæ–‡æ¡£](https://multiqc.info/)

## ğŸ“‹ ä¸‹ä¸€æ­¥

é¢„å¤„ç†å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š
1. ä½¿ç”¨å¤„ç†åçš„FASTQæ–‡ä»¶è¿›è¡ŒåŸºå› ç»„æ¯”å¯¹
2. è¿›è¡Œå˜å¼‚æ£€æµ‹åˆ†æ
3. æ‰§è¡Œè´¨é‡æ§åˆ¶éªŒè¯
4. å¼€å§‹ä¸‹æ¸¸ç”Ÿç‰©ä¿¡æ¯å­¦åˆ†æ
