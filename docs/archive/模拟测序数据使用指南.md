# 奶牛基因组模拟测序数据使用指南

## 概述

本指南介绍如何使用项目中的工具从奶牛参考基因组生成模拟测序数据，并在AWS Omics中进行分析。这对于学习基因组学分析流程、测试工作流程和演示AWS Omics功能非常有用。

## 🎯 模拟数据的优势

### 为什么使用模拟数据？
1. **已知真相**: 我们知道所有变异的真实位置和类型
2. **成本效益**: 无需购买昂贵的真实测序数据
3. **可控性**: 可以控制变异数量、类型和分布
4. **学习友好**: 适合学习和测试分析流程
5. **快速迭代**: 可以快速生成不同参数的数据集

### 模拟数据特点
- **基于真实参考基因组**: 使用奶牛ARS-UCD1.2参考基因组
- **真实的变异类型**: 包括SNP、插入、删除等
- **符合生物学规律**: GC含量、变异频率等符合实际情况
- **标准格式**: 生成标准的FASTQ和VCF格式文件

## 🛠️ 工具介绍

### 1. simulate_sequencing_data.py
**功能**: 从参考基因组生成模拟测序数据

**主要特性**:
- 生成SNP、InDel等变异
- 创建包含变异的测序reads
- 输出标准的VCF和FASTQ格式
- 生成详细的模拟报告

### 2. analyze_simulated_data.py
**功能**: 分析模拟数据的质量和特征

**主要特性**:
- 统计变异类型和分布
- 分析reads质量和GC含量
- 生成可视化图表
- 评估数据质量

### 3. aws_omics_workflow_example.py
**功能**: 创建AWS Omics工作流和部署脚本

**主要特性**:
- 生成WDL工作流定义
- 创建AWS资源部署脚本
- 提供完整的云端分析流程

## 📋 使用步骤

### 步骤1: 生成模拟数据

```bash
# 基础模拟（推荐用于学习）
python3 simulate_sequencing_data.py \\
    --num-snps 500 \\
    --num-indels 100 \\
    --num-reads 5000 \\
    --max-chromosomes 2

# 大规模模拟（用于性能测试）
python3 simulate_sequencing_data.py \\
    --num-snps 10000 \\
    --num-indels 2000 \\
    --num-reads 50000 \\
    --max-chromosomes 5
```

**参数说明**:
- `--num-snps`: SNP变异数量
- `--num-indels`: InDel变异数量  
- `--num-reads`: 生成的reads数量
- `--read-length`: reads长度（默认150bp）
- `--max-chromosomes`: 使用的染色体数量（节省内存）

### 步骤2: 分析模拟数据

```bash
# 分析生成的数据质量
python3 analyze_simulated_data.py

# 指定数据目录
python3 analyze_simulated_data.py --data-dir ./simulated_data
```

### 步骤3: 创建AWS Omics工作流

```bash
# 创建WDL工作流定义
python3 aws_omics_workflow_example.py --action create-workflow-def

# 创建部署脚本
python3 aws_omics_workflow_example.py --action create-deployment-script
```

### 步骤4: 部署到AWS Omics

```bash
# 运行部署脚本
chmod +x deploy_omics_simulation.sh
./deploy_omics_simulation.sh
```

## 📊 输出文件说明

### 模拟数据文件

| 文件名 | 格式 | 描述 |
|--------|------|------|
| `simulated_variants.vcf` | VCF | 真实变异列表（金标准） |
| `simulated_reads.fastq` | FASTQ | 模拟测序reads |
| `simulation_report.json` | JSON | 详细的模拟报告 |
| `simulation_analysis.png` | PNG | 数据质量可视化图表 |

### VCF文件示例
```
#CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO	FORMAT	Sample1
NC_037328.1	103435	var_000001	A	AC	28	PASS	DP=17	GT:DP	0/1:17
NC_037328.1	2178702	var_000002	T	C	33	PASS	DP=21	GT:DP	0/1:21
```

### FASTQ文件示例
```
@read_000001 NC_037329.1:58541633-58541782
GCCATCAACAAGCAGCCCATGCACTGTGACAGGAGGGTAGCTGCTGCTCTCTGCAATTGGAGAAATCCTGTGTGCAACACTGAAGACCCAGTGCAGCCAAAAATAAAAGAAATAAAGGAGTTAACTCATTGAAAAAAGGATTTTTCATAG
+
I7$HB?,I8%--A*$8*)1EEDF4F"39$GBI'7)6="#%,6>81.&'9:21A7()10;)1":1":./,A*22>IDF>2%"+E(,.?.G4FG(8;C;H&+B7:D+DDH6&@7"&I+.8=.4B":&:D+"3-5#E)@7F3/B!$9C03#?)
```

## 🔬 分析工作流程

### 1. 序列比对
```bash
# 使用BWA进行序列比对
bwa index reference_genome.fna
bwa mem reference_genome.fna simulated_reads.fastq > aligned.sam
samtools view -bS aligned.sam | samtools sort > aligned.sorted.bam
samtools index aligned.sorted.bam
```

### 2. 变异检测
```bash
# 使用GATK进行变异检测
gatk HaplotypeCaller \\
    -R reference_genome.fna \\
    -I aligned.sorted.bam \\
    -O detected_variants.vcf
```

### 3. 结果比较
```bash
# 比较检测到的变异与真实变异
bcftools isec -p comparison_results \\
    simulated_variants.vcf \\
    detected_variants.vcf
```

## 📈 性能基准测试

### 不同规模的数据集

| 数据集规模 | SNPs | InDels | Reads | 生成时间 | 文件大小 |
|------------|------|--------|-------|----------|----------|
| 小型 | 100 | 20 | 1,000 | ~30秒 | ~350KB |
| 中型 | 1,000 | 200 | 10,000 | ~2分钟 | ~3.5MB |
| 大型 | 10,000 | 2,000 | 100,000 | ~15分钟 | ~35MB |

### 推荐配置

**学习和演示**:
```bash
python3 simulate_sequencing_data.py \\
    --num-snps 500 \\
    --num-indels 100 \\
    --num-reads 5000
```

**工作流测试**:
```bash
python3 simulate_sequencing_data.py \\
    --num-snps 2000 \\
    --num-indels 400 \\
    --num-reads 20000
```

**性能基准**:
```bash
python3 simulate_sequencing_data.py \\
    --num-snps 10000 \\
    --num-indels 2000 \\
    --num-reads 100000
```

## 🎓 教学应用

### 基因组学课程
1. **变异检测原理**: 通过已知变异验证检测算法
2. **质量控制**: 学习评估测序数据质量
3. **工作流设计**: 练习构建分析流程
4. **结果解释**: 理解变异注释和功能预测

### 实验设计
1. **参数优化**: 测试不同算法参数的影响
2. **工具比较**: 比较不同变异检测工具的性能
3. **流程验证**: 验证分析流程的正确性
4. **成本估算**: 评估不同规模数据的处理成本

## 🔧 高级用法

### 自定义变异模式
```python
# 修改 simulate_sequencing_data.py 中的参数
# 例如：增加特定类型变异的比例
def generate_snps(self, num_snps=1000, transition_bias=0.7):
    # 转换/颠换比例偏向（更符合真实情况）
    pass
```

### 特定区域模拟
```python
# 只在特定基因区域生成变异
def generate_variants_in_genes(self, gene_regions):
    # 基于基因注释文件限制变异位置
    pass
```

### 群体遗传学模拟
```python
# 模拟多个个体的基因型
def simulate_population(self, num_individuals=10):
    # 生成具有不同基因型的多个样本
    pass
```

## 🚨 注意事项

### 内存使用
- 大染色体会占用大量内存
- 建议使用 `--max-chromosomes` 参数限制
- 监控系统内存使用情况

### 文件大小
- FASTQ文件会随reads数量线性增长
- 考虑磁盘空间限制
- 可以使用压缩格式节省空间

### 生物学真实性
- 模拟数据简化了真实情况
- 不包含测序错误和偏向性
- 变异分布可能不完全符合真实情况

## 📚 扩展阅读

### 相关工具
- **ART**: 更复杂的测序模拟器
- **DWGSIM**: 全基因组测序模拟
- **NEAT**: 包含结构变异的模拟器

### AWS Omics资源
- [AWS Omics 用户指南](https://docs.aws.amazon.com/omics/)
- [WDL语言规范](https://github.com/openwdl/wdl)
- [GATK最佳实践](https://gatk.broadinstitute.org/hc/en-us/sections/360007226651)

### 基因组学资源
- [NCBI基因组数据库](https://www.ncbi.nlm.nih.gov/genome/)
- [Ensembl基因组浏览器](https://www.ensembl.org/)
- [UCSC基因组浏览器](https://genome.ucsc.edu/)

---

**最后更新**: 2025年8月7日  
**版本**: v1.0  
**适用于**: AWS Omics 奶牛基因组学演示项目
